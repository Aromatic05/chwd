[nvidia-dkms]
ai_sdk = false
class_ids = "0300 0302 0380"
desc = "Closed source NVIDIA drivers for Linux (Latest)"
device_ids = "*"
device_name_pattern = '((GM|GP)+[0-9]+[^M]*\s.*)'
packages = "nvidia-utils egl-wayland nvidia-settings opencl-nvidia lib32-opencl-nvidia lib32-nvidia-utils libva-nvidia-driver vulkan-icd-loader lib32-vulkan-icd-loader"
pre_install = '''
    echo preinstall
'''
post_install = '''
    cat <<EOF >/etc/mkinitcpio.conf.d/10-chwd.conf
# This file is automatically generated by chwd. PLEASE DO NOT EDIT IT.
MODULES+=(nvidia nvidia_modeset nvidia_uvm nvidia_drm)
EOF
    mkinitcpio -P

    # Add libva-nvidia-driver to profile
    echo "export LIBVA_DRIVER_NAME=nvidia" > /etc/profile.d/nvidia-vaapi.sh
'''
pre_remove = '''
    echo preremove
'''
post_remove = """
    rm -f /etc/mkinitcpio.conf.d/10-chwd.conf
    rm -f /etc/profile.d/nvidia-vaapi.sh
    mkinitcpio -P
"""
priority = 12
vendor_ids = "10de"
